{% ckan_extends %}

{% block styles %}
  {{ super() }}
  <!-- Modern CSS Framework with Variables -->
  <link rel="stylesheet" href="/theme_ejemplo.css" />
  
  <!-- Material Icons for better iconography -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
  
  <!-- Inter Font for better typography -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Custom responsive enhancements -->
  <style>
    /* Responsive optimization styles */
    html {
      font-size: 16px;
      line-height: 1.6;
    }
    
    @media (max-width: 480px) {
      html {
        font-size: 14px;
      }
    }
    
    /* Smooth scrolling behavior */
    * {
      scroll-behavior: smooth;
    }
    
    /* Improved focus states for accessibility */
    *:focus {
      outline: 2px solid var(--unesco-blue, #0069B4);
      outline-offset: 2px;
    }
    
    /* Loading states */
    .loading {
      opacity: 0.7;
      pointer-events: none;
    }
    
    /* Enhanced mobile navigation */
    @media (max-width: 768px) {
      .masthead .navigation {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
      }
      
      .masthead .nav-pills {
        padding: 1rem;
      }
      
      .masthead .nav-pills li {
        margin-bottom: 0.5rem;
      }
      
      .masthead .nav-pills li a {
        display: block;
        padding: 0.75rem 1rem;
        background: rgba(0, 105, 180, 0.1);
        border-radius: 0.5rem;
        margin-bottom: 0.25rem;
      }
    }
    
    /* Print optimizations */
    @media print {
      .masthead,
      .site-footer,
      .hero,
      .btn,
      nav,
      .navigation {
        display: none !important;
      }
      
      body {
        font-size: 12pt;
        line-height: 1.4;
      }
      
      h1, h2, h3, h4, h5, h6 {
        color: #000 !important;
        page-break-after: avoid;
      }
      
      .container {
        max-width: none !important;
        padding: 0 !important;
      }
    }
  </style>
{% endblock %}

{% block meta %}
  {{ super() }}
  <!-- Enhanced meta tags for better SEO and performance -->
  <meta name="theme-color" content="#0069B4">
  <meta name="msapplication-TileColor" content="#0069B4">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="IHP-WINS">
  
  <!-- Performance optimizations -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="format-detection" content="telephone=no">
  
  <!-- Open Graph meta tags for better social sharing -->
  <meta property="og:site_name" content="UNESCO IHP-WINS">
  <meta property="og:type" content="website">
  <meta property="og:locale" content="en_US">
  
  <!-- Preload critical resources -->
  <link rel="preload" href="/theme_ejemplo.css" as="style">
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" as="style">
{% endblock %}

{% block scripts %}
  {{ super() }}
  
  <!-- Enhanced JavaScript for responsive and interactive features -->
  <script>
    // Responsive enhancement utilities
    (function() {
      'use strict';
      
      // Wait for DOM to be ready
      document.addEventListener('DOMContentLoaded', function() {
        
        // Mobile navigation enhancement
        function initMobileNavigation() {
          const navToggle = document.getElementById('main-navigation-toggle');
          const navigation = document.querySelector('.masthead .navigation');
          
          if (navToggle && navigation) {
            navToggle.addEventListener('click', function() {
              navigation.classList.toggle('show');
              this.setAttribute('aria-expanded', 
                this.getAttribute('aria-expanded') === 'true' ? 'false' : 'true'
              );
            });
            
            // Close navigation when clicking outside
            document.addEventListener('click', function(e) {
              if (!navigation.contains(e.target) && !navToggle.contains(e.target)) {
                navigation.classList.remove('show');
                navToggle.setAttribute('aria-expanded', 'false');
              }
            });
          }
        }
        
        // Smooth scroll for anchor links
        function initSmoothScroll() {
          const links = document.querySelectorAll('a[href^="#"]');
          links.forEach(link => {
            link.addEventListener('click', function(e) {
              const href = this.getAttribute('href');
              if (href !== '#') {
                const target = document.querySelector(href);
                if (target) {
                  e.preventDefault();
                  target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                  });
                }
              }
            });
          });
        }
        
        // Image lazy loading enhancement
        function initImageOptimization() {
          if ('IntersectionObserver' in window) {
            const imageObserver = new IntersectionObserver((entries, observer) => {
              entries.forEach(entry => {
                if (entry.isIntersecting) {
                  const img = entry.target;
                  if (img.dataset.src) {
                    img.src = img.dataset.src;
                    img.removeAttribute('data-src');
                  }
                  img.classList.add('loaded');
                  observer.unobserve(img);
                }
              });
            });
            
            document.querySelectorAll('img[loading="lazy"]').forEach(img => {
              imageObserver.observe(img);
            });
          }
        }
        
        // Touch gesture enhancements for mobile
        function initTouchEnhancements() {
          if ('ontouchstart' in window) {
            document.body.classList.add('touch-device');
            
            // Add tap feedback to interactive elements
            const interactiveElements = document.querySelectorAll('button, .btn, a, [role="button"]');
            interactiveElements.forEach(element => {
              element.addEventListener('touchstart', function() {
                this.style.transform = 'scale(0.98)';
              });
              
              element.addEventListener('touchend', function() {
                setTimeout(() => {
                  this.style.transform = '';
                }, 150);
              });
            });
          }
        }
        
        // Responsive table enhancement
        function initResponsiveTables() {
          const tables = document.querySelectorAll('table');
          tables.forEach(table => {
            if (!table.closest('.table-responsive')) {
              const wrapper = document.createElement('div');
              wrapper.className = 'table-responsive';
              table.parentNode.insertBefore(wrapper, table);
              wrapper.appendChild(table);
            }
          });
        }
        
        // Performance monitoring
        function initPerformanceMonitoring() {
          // Log page load performance
          if ('performance' in window) {
            window.addEventListener('load', function() {
              setTimeout(() => {
                const perfData = performance.getEntriesByType('navigation')[0];
                if (perfData) {
                  console.log('Page Load Time:', Math.round(perfData.loadEventEnd - perfData.loadEventStart), 'ms');
                }
              }, 1000);
            });
          }
        }
        
        // Enhanced form validation
        function initFormEnhancements() {
          const forms = document.querySelectorAll('form');
          forms.forEach(form => {
            // Add loading states to form submissions
            form.addEventListener('submit', function() {
              const submitBtn = this.querySelector('button[type="submit"], input[type="submit"]');
              if (submitBtn) {
                submitBtn.classList.add('loading');
                submitBtn.disabled = true;
                
                // Re-enable after timeout as fallback
                setTimeout(() => {
                  submitBtn.classList.remove('loading');
                  submitBtn.disabled = false;
                }, 30000);
              }
            });
            
            // Enhanced input focus states
            const inputs = form.querySelectorAll('input, textarea, select');
            inputs.forEach(input => {
              input.addEventListener('focus', function() {
                this.parentElement.classList.add('focused');
              });
              
              input.addEventListener('blur', function() {
                this.parentElement.classList.remove('focused');
              });
            });
          });
        }
        
        // Initialize all enhancements
        initMobileNavigation();
        initSmoothScroll();
        initImageOptimization();
        initTouchEnhancements();
        initResponsiveTables();
        initPerformanceMonitoring();
        initFormEnhancements();
        
        // Add resize handler for responsive adjustments
        let resizeTimer;
        window.addEventListener('resize', function() {
          clearTimeout(resizeTimer);
          resizeTimer = setTimeout(() => {
            // Re-calculate responsive elements if needed
            document.body.classList.toggle('mobile', window.innerWidth < 768);
            document.body.classList.toggle('tablet', window.innerWidth >= 768 && window.innerWidth < 992);
            document.body.classList.toggle('desktop', window.innerWidth >= 992);
          }, 250);
        });
        
        // Initial responsive class setting
        document.body.classList.toggle('mobile', window.innerWidth < 768);
        document.body.classList.toggle('tablet', window.innerWidth >= 768 && window.innerWidth < 992);
        document.body.classList.toggle('desktop', window.innerWidth >= 992);
      });
      
      // Error handling for JavaScript
      window.addEventListener('error', function(e) {
        console.warn('JavaScript error:', e.error);
      });
      
      // Handle browser back/forward navigation
      window.addEventListener('popstate', function(e) {
        // Smooth scroll to top when navigating back
        window.scrollTo({
          top: 0,
          behavior: 'smooth'
        });
      });
      
    })();
  </script>
  
  <!-- Service Worker for performance (optional) -->
  <script>
    // Register service worker for better caching (if available)
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        // Only register in production
        if (location.hostname !== 'localhost' && location.hostname !== '127.0.0.1') {
          navigator.serviceWorker.register('/sw.js').then(function(registration) {
            console.log('ServiceWorker registration successful');
          }).catch(function(err) {
            console.log('ServiceWorker registration failed');
          });
        }
      });
    }
  </script>
{% endblock %}
